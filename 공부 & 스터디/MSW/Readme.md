# MSW(Mock Service Worker)

<img width="729" alt="image" src="https://github.com/Jae-hong-lee/TIL/assets/72030487/bd65573d-358d-44b0-b92c-79ee4a577edf">

## 왜 쓰는 걸까?

![Kakao-msw](https://github.com/Jae-hong-lee/TIL/assets/72030487/5819ad4c-2551-4db8-abf9-54a381a5d6df)

프론트엔드를 개발하다가 보면 전체 개발 프로세스 중 요구사항 분석 및 기획, 백엔드개발, 프론트개발에 이르는 각각의 과정이 크게 겹쳐지지 않고 진행되는 것이 가장 이상적이다.
개발 과정에서 도출되는 요구사항이나 인터페이스 변경이 있다면, 다시 작업해야하는 경우가 발생할 수 있기 때문이다.

---

### 현실적인 개발

![image](https://github.com/Jae-hong-lee/TIL/assets/72030487/6d857bf8-d0da-4ff3-952f-f1ff4360388e)

하지만 현실적으로는 많은 시간을 프론트엔드와 백엔드를 병행하여 개발하게된다.

![@khy226/msw로-모의-서버-만들기](https://github.com/Jae-hong-lee/TIL/assets/72030487/7358521b-69b2-47fe-86ba-050eb31b5d7d)

> 기획자 : XX 작업은 어떻게 진행 중인가요?
> 프론트엔드 개발자 : 그게… 아직 API가 준비되지 않아서 다음 주까지는 기다려야 합니다.

API 및 백엔드 개발에 의존적인 부분이라면 위와같이 대기시간이 있는 비효율적인 프로세스가 반복되게 된다. 촉박한 기간 내에 API 의존적 개발을 하게 된다면 FE는 기간 막바지까지 기능 개발을 해야하고 테스트 시간은 줄어든게 된다. `그 이후는..`

그래서 생각한게 `Mocking`을 이용해서 개발하는 방법
백엔드와 종속적인 개발 영역이 있는 경우, 프론트는 필요한 API를 사전 협의하여 백엔드에게 받아야한다.
제공 받았을 경우, 사전 개발을 진행하게 되고 API를 통해 실제로 연동 될 때까지 개발을 진행할 수 있다.

**하지만**, API 자체에 대한 의존성을 일단 가져가지 않고, Mocking 을 통해 개발을 진행한 다음, 실제 사용해야 하는 API가 나온 시점에서 API 의 실제 인터페이스에 맟게 컨버팅하는 과정을 따로 가지는 개발 방법으로 진행하기도 한다.
![image](https://github.com/Jae-hong-lee/TIL/assets/72030487/2004d898-76c2-47f2-a7dd-628bd4dcd3c5)

---

### 일반적인 Mocking

- 어플리케이션 내부 로직에 직접 Mocking
- Mocking 서버 만들기

가장 간단한 방법으로는 화면에 필요한 데이터를 어플리케이션에 직접 Mocking 해서 붙이는 방식. 이렇게 작업하면 구현이 쉽고 빠르게 적용할 수 있다.
하지만, 서비스 로직에 직접 Mocking 한다는 점(나중에 수정해야할 경우가 생길 수도..), HTTP 메소드와 네트워크의 응답상태에 따라 각각 대응하기 쉽지않다.

두번쨰 방법으로 Mocking 서버를 만드는 방법. 서비스 로직을 수정하지 않아도 된다.
하지만, 구현하는데 시간이 많이 걸리고, 실버 서버와 비슷하지만 다른 방식으로 동작하기 때문에 이 방법도 기존 코드를 수정해야하는 일이 발생할 수 있다.
서버구현은 비용과 시간도 많이 들어간다. (비효율적)

> 또한, 대기, 로딩, 에러 등 API의 응답 상태에 따른 여러 가지 구현을 가지고 있을 경우도 있을 수 있다.
> 이 경우, 각 단위 개발은 어떻게 진행한다고 하더라도 실제 화면을 구성하기 위한 구현 단계에서는 각 케이스별로 임의의 상태를 만들어 보면서 개발하거나 그 자체를 디버깅하기에 어려움이 있다.

**결국에는 우리는 실제 API 를 사용하는 것처럼 네트워크 수준에서 Mocking 하는 것**

**MSW를** 사용하면 서비스 로직을 직접 수정할 필요도 없고, 직접 모킹 서버를 구현할 필요도 없다.
또한, 어플리케이션 아닌 네트워크에서 요청을 가로채 응답을 보내기 때문에 모든 종류의 네트워크 라이브러리 (axios, react-query 등) 및 네이티브 fetch 메서드와 함께 사용할 수 있다.

---

## Mock Service Worker란?

**MSW** 는 서브스 워커를 사용하여 네트워크 호출을 가로채는 API 모킹(mocking) 라이브러리이다. 쉽게 말해, 브라우저에 기생해서 마치 백엔트 API 인 척하면서 프론트 요청에 따라 가짜 데이터를 응답해주는 녀석!
따라서, MSW 통해 서버를 구축하지 않아도 API를 네트워크단에서 Mocking 할 수 있다.

MSW는 Service Worker를 기반으로 모의 API를 만들어내기 때문에 다른 프론트엔드에서 사용하는 수많은 라이브러리나 프레임워크에 종속적이지 않고 호환성에 문제없이 동작한다.

> Service Worker
> Service Worker는 웹 어플리케이션의 메인 스레드와 분리된 별도의 백그라운드 스레드에서 실행시킬 수 있는 기술 중 하나.
> Service Worker 덕분에 네트워크 요청을 가로채는 행위를 할 수 있음.
> 하지만, 사용이 제한되는 경우도 있다.

### 동작원리

![image](https://github.com/Jae-hong-lee/TIL/assets/72030487/cd38aca7-281a-4324-adde-2897b5a228cc)

MSW를 설치하게 되면 브라우저에 Service Worker을 설치한다.
이후, 브라우저에서 이루어지는 실제 네트워크 요청(fetch 등..) 들을 Service Worker가 가로채게 된다.
Service Worker는 요청을 복사해서 MSW 로 보내주고, 등록된 핸들러를 통해 모의 응답(Mock Response)을 제공받게 되고 모의 응답은 브라우저에게 그대로 전달되게 된다.

### msw를 활용한 개발방식

![image](https://github.com/Jae-hong-lee/TIL/assets/72030487/1111ad44-271a-4847-a6f5-9df388a59767)

1. 기획자가 요구사항 전달
2. FE, BE 개발자간의 API 협의
3. BE 개발자의 API 스펙 제공
4. **MSW를 통해 네트워크 레벨에서의 Mocking진행**
5. 이를 활용하여 어플리케이션 개발
6. API 없이도 높은 완성도를 가지고 기획자에게 미리 어플리케이션 확인시켜주기
7. 피드백
8. 4,5,6,7이 진행되는 기간동안 백엔드의 API 개발
9. API 제공
10. 프론트는 별 다른 작업없이 MSW 스위치 오프하고 Production으로 배포

> 더 나아가, 이러한 장점은 기획자 등의 다른 누군가에게 각 화면을 공유하고 피드백을 받아야 하는 상황이 발생했을 때에도, 추가적으로 MSW에서 해당 상황을 만들어낼 수 있도록 작업을 해 둔다면 별다른 서비스 로직의 수정 없이도 MSW를 통해 제공이 가능해집니다.

---

[Mocking으로 생산성까지 챙기는 FE 개발 - Kakao](https://tech.kakao.com/2021/09/29/mocking-fe/)
[MSW(Mock Service Worker)로 더욱 생산적인 FE 개발하기](https://velog.io/@khy226/msw%EB%A1%9C-%EB%AA%A8%EC%9D%98-%EC%84%9C%EB%B2%84-%EB%A7%8C%EB%93%A4%EA%B8%B0)
