# Virtual DOM

`Virtual DOM (VDOM)`은 UI의 이상적인 또는 **가상**적인 표현을 메모리에 저장하고 `ReactDOM`과 같은 라이브러리에 의해 **실제** DOM과 동기화하는 프로그래밍 개념

![](https://velog.velcdn.com/images%2Fvagabondms%2Fpost%2Fb0f3fccb-4591-4fd3-ad7f-de4c4bf8dc7a%2Fimage.png)

### DOM

> **브라우저 렌더링**과 관련하여 많이 본 그림

간단하게 설명하면 과정은 아래와 같이 진행된다.

1. HTML을 파싱하여 DOM 객체를 생성하고, CSS를 파싱하여 스타일 규칙을 만듭니다.
2. 이 두개를 합쳐서 실제로 웹 브라우저에 보여져야할 요소를 표현한 "**렌더 트리**" 라는 것을 만듭니다.
3. 이 렌더 트리를 기준으로 레이아웃을 배치하고 색을 칠하는 등의 작업.

프로그래밍에 의해 DOM을 변경해야하고 변경할 구성 요소가 100개면 위의 과정을 100번을 하는 비효율적인 작업을 했다.

> 사실 브라우저는 바보가 아니라 100개 작업중 100개를 다하지않고 20번정도는 할 것...
> 이해를 돕기 위한 예시고 사실은 DOM을 제어하는 메서드에 따라서 다르지만 어느정도 합쳐서 배치로 작업할 것이다

- 정확히는 DOM을 변경하는게 문제가 아니고 렌더링을 여러번 하는게 문제!

복잡한 **SPA(싱글 페이지 어플리케이션)** 에서는 DOM 조작이 많이 발생하는데, 그 뜻은 그 변화를 적용하기 위해 브라우저가 많이 연산을 해야한단 소리고, 전체적인 프로세스를 비효율적으로 만들게 된다.

### 동작원리

Virtual Dom 은 View 에 변화가 있다면, 그 변화는 실제 DOM에 적용하기 전에 가상의 DOM 에 먼저 적용시키고 최정적인 결과를 실제 DOM으로 전달한다, 브라우저 내에서 발생하는 연산의 양을 줄이면서 성능개선이 되는 것

#### 리액트가 가상돔을 반영하는 절차

특정 페이지에서 데이터가 변했다고 가정했을 때, 리액트를 이용해 돔을 업데이트시키는 절차!

1. 변화가 일어남 ➡️ 변화된 버전을 가상돔으로 바꿈
   - 데이터가 업데이트 되면 전체 UI를 가상돔에 리렌더링
2. 가상돔끼리 비교
   - 변화 전의 가상돔과 변화된 가상돔을 비교한다.
3. 바뀐 부분만 적용
   - 바뀐 부분만 실제 돔에 적용을 함으로서 레이아웃 계산은 한 번만 이행된다.
     > ex. 네비게이션(컴포넌트)을 열었을 때 특정 영역(컴포넌트)이 빨갛게 변하면서 위치가 변경되는 경우의 레이아웃 계산이 일괄로 단 한 번만 이행

![VDOM](https://user-images.githubusercontent.com/72030487/232277535-8e363e4e-9109-41ba-8ed9-08e1f6c7f16e.png)

작은 규모의 레이아웃(리플로우)이 여러번 발생하는 것보다 큰 규모의 레이아웃이 한 번 발생하는 것은 성능상의 큰 차이를 나타낸다.
리액트는 위와 같은 얕은 비교와 일괄 돔 업데이트 방식을 이용해 성능 향상을 이끄는 것이다.

---

[react- virtual dom](https://ko.reactjs.org/docs/faq-internals.html)
